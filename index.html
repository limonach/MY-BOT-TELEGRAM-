<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orange ğŸŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        :root {
            --primary: #E74C3C; --secondary: #F39C12; --light: #FDFEFE; --dark: #2C3E50;
            --success: #27AE60; --danger: #C0392B; --surface: #FFFFFF; --border: #EAEDED;
            --text-primary: #2C3E50; --text-secondary: #808B96; --warning: #F39C12;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--light); color: var(--text-primary); }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 15px; }
        
        .card { background: var(--surface); border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid var(--border); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 25px; border-radius: 12px; text-align: center; }
        .stat-number { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
        .stat-label { font-size: 1.1rem; opacity: 0.9; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; font-family: 'Tajawal', sans-serif; transition: all 0.3s; }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1); }
        
        .btn { padding: 12px 25px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Tajawal', sans-serif; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #c0392b; transform: translateY(-2px); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-block { width: 100%; }
        
        .table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .table th, .table td { padding: 15px; text-align: right; border-bottom: 1px solid var(--border); }
        .table th { background-color: var(--light); font-weight: 700; color: var(--dark); }
        .table tr:hover { background-color: rgba(0,0,0,0.02); }
        
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid var(--border); }
        .tab { padding: 15px 25px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; font-weight: 600; }
        .tab.active { border-bottom-color: var(--primary); color: var(--primary); }
        
        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-danger { background: var(--danger); color: white; }
        .badge-info { background: var(--primary); color: white; }
        
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-info { background: rgba(52, 152, 219, 0.1); border: 1px solid #3498db; color: #2980b9; }
        .alert-warning { background: rgba(243, 156, 18, 0.1); border: 1px solid var(--warning); color: #e67e22; }
        
        .reward-tier-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 15px 0; }
        .tier-option { padding: 15px; border: 2px solid var(--border); border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .tier-option:hover { border-color: var(--primary); }
        .tier-option.selected { border-color: var(--primary); background: rgba(231, 76, 60, 0.1); }
        .tier-reward { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .tier-user-reward { color: var(--success); font-weight: 600; }
        .tier-system-fee { color: var(--text-secondary); font-size: 0.9rem; }
        
        .progress-bar { height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary)); transition: width 0.5s; }
        
        .campaign-card { border-left: 4px solid var(--primary); margin-bottom: 15px; }
        .campaign-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .campaign-stat { text-align: center; padding: 10px; background: var(--light); border-radius: 8px; }
        
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .table { font-size: 0.9rem; }
            .table th, .table td { padding: 10px 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1><i class="fas fa-ad"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„</h1>
            <p>Ø£Ù†Ø´Ø¦ Ø­Ù…Ù„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© ÙˆØ§Ø±Ø¨Ø­ Ù…Ø¹ Orange ğŸŠ</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-campaigns">0</div>
                <div class="stat-label">Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-conversions">0</div>
                <div class="stat-label">Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="advertiser-balance">0</div>
                <div class="stat-label">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù† (Ù†Ù‚Ø·Ø©)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="system-revenue">0</div>
                <div class="stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ù†Ù‚Ø·Ø©)</div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" data-tab="create-campaign">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="tab" data-tab="my-campaigns">Ø­Ù…Ù„Ø§ØªÙŠ</div>
            <div class="tab" data-tab="conversions">Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</div>
            <div class="tab" data-tab="finance">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
        </div>

        <!-- Create Campaign Tab -->
        <div id="create-campaign" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù…Ù„Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 
                    <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‡Ø§Ù…Ø©:</strong> 
                    Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø¹Ø± 250 Ù†Ù‚Ø·Ø©ØŒ Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø¨Ø­Ø¯ÙˆØ¯ 50 Ù†Ù‚Ø·Ø©. Ø±Ø¨Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø«Ø§Ø¨Øª 150 Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ ØªØ­ÙˆÙŠÙ„.
                </div>

                <form id="campaign-form">
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</label>
                        <input type="text" class="form-control" id="campaign-title" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù…Ù„Ø©" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ¬Ù‡Ø© (Ù‚Ù†Ø§Ø©/Ø¨ÙˆØª/Ø±Ø§Ø¨Ø·)</label>
                        <input type="url" class="form-control" id="target-link" placeholder="https://t.me/..." required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø©/Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" class="form-control" id="channel-id" placeholder="-1001234567890">
                        <small style="color: var(--text-secondary);">Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø¹Ø¨Ø± Ø¨ÙˆØª Telegram</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚</label>
                        <select class="form-control" id="verification-mode">
                            <option value="bot_admin_required">Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± Ø¨ÙˆØª (Ù…ÙØ¶Ù„ - ÙŠØªØ·Ù„Ø¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙˆØª)</option>
                            <option value="bot_member_optional">Ø§Ù„ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± Ø¨ÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
                            <option value="forward_message_proof">Ø¥Ø«Ø¨Ø§Øª Ø¨Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ø®ØªØ± Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ (rewardTier)</label>
                        <div class="reward-tier-selector" id="reward-tier-selector">
                            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù…Ø¯Ø© Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø£Ø¯Ù†Ù‰ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)</label>
                        <input type="number" class="form-control" id="min-stay" value="60" min="30">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (Ù†Ù‚Ø·Ø©)</label>
                        <input type="number" class="form-control" id="campaign-budget" min="1000" required>
                    </div>

                    <div class="alert alert-warning" id="budget-calc">
                        <i class="fas fa-calculator"></i>
                        <strong>Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©:</strong>
                        <span id="cost-per-conversion">0</span> Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ ØªØ­ÙˆÙŠÙ„ Ã— 
                        <span id="max-conversions">0</span> ØªØ­ÙˆÙŠÙ„ = 
                        <span id="total-cost">0</span> Ù†Ù‚Ø·Ø©
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-rocket"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©
                    </button>
                </form>
            </div>
        </div>

        <!-- My Campaigns Tab -->
        <div id="my-campaigns" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-bullhorn"></i> Ø­Ù…Ù„Ø§ØªÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</h2>
                </div>
                <div id="campaigns-list">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
            </div>
        </div>

        <!-- Conversions Tab -->
        <div id="conversions" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-chart-line"></i> Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª ÙˆØ§Ù„ØªØ­Ù‚Ù‚</h2>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø­Ù…Ù„Ø©</th>
                            <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                            <th>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="conversions-list">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Finance Tab -->
        <div id="finance" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-wallet"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
                </div>
                
                <div class="stats-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div class="card">
                        <h3><i class="fas fa-money-bill-wave"></i> Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¹Ù„Ù†</h3>
                        <div class="stat-number" style="color: var(--primary);" id="advertiser-points">0</div>
                        <p>Ù†Ù‚Ø·Ø©</p>
                        <button class="btn btn-primary mt-3" onclick="addPoints()">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3><i class="fas fa-chart-pie"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                        <div class="stat-number" style="color: var(--success);" id="system-points">0</div>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-list">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCX7uxoXtRiC7F3kYzpoZOiC2FaKsFdrtI",
            authDomain: "my-bot-ads-1.firebaseapp.com",
            databaseURL: "https://my-bot-ads-1-default-rtdb.firebaseio.com",
            projectId: "my-bot-ads-1",
            storageBucket: "my-bot-ads-1.firebasestorage.app",
            messagingSenderId: "484090238589",
            appId: "1:484090238589:web:aad993f9631bb10f338314"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Global Variables
        let currentAdvertiserId = "adv_" + Date.now(); // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ø°Ø§ ÙŠÙƒÙˆÙ† ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        let rewardTiers = [250, 300, 350, 400, 450, 500];
        const SYSTEM_FEE = 150;

        // Initialize the Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadRewardTiers();
            loadAdvertiserData();
            loadCampaigns();
            loadConversions();
            loadTransactions();
        });

        function initializeApp() {
            // Initialize advertiser if not exists
            const advertiserRef = db.ref('advertisers/' + currentAdvertiserId);
            advertiserRef.once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    advertiserRef.set({
                        advertiserId: currentAdvertiserId,
                        pointsBalance: 10000,
                        createdAt: Date.now(),
                        totalSpent: 0,
                        activeCampaigns: 0
                    });
                }
            });
        }

        function setupEventListeners() {
            // Tab Navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabName).classList.add('active');
                });
            });

            // Campaign Form Submission
            document.getElementById('campaign-form').addEventListener('submit', function(e) {
                e.preventDefault();
                createCampaign();
            });

            // Budget Calculation
            document.getElementById('campaign-budget').addEventListener('input', updateBudgetCalculation);
        }

        function loadRewardTiers() {
            const container = document.getElementById('reward-tier-selector');
            container.innerHTML = '';

            rewardTiers.forEach(tier => {
                const userReward = tier - SYSTEM_FEE;
                const option = document.createElement('div');
                option.className = 'tier-option';
                option.innerHTML = `
                    <div class="tier-reward">${tier}</div>
                    <div class="tier-user-reward">${userReward} Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                    <div class="tier-system-fee">${SYSTEM_FEE} Ù„Ù„Ù†Ø¸Ø§Ù…</div>
                `;
                option.addEventListener('click', function() {
                    document.querySelectorAll('.tier-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('selected-tier').value = tier;
                    updateBudgetCalculation();
                });
                container.appendChild(option);
            });

            // Select first tier by default
            if (container.firstChild) {
                container.firstChild.classList.add('selected');
                document.getElementById('selected-tier').value = rewardTiers[0];
            }
        }

        function updateBudgetCalculation() {
            const budget = parseInt(document.getElementById('campaign-budget').value) || 0;
            const selectedTier = document.querySelector('.tier-option.selected');
            
            if (selectedTier) {
                const tierValue = parseInt(selectedTier.querySelector('.tier-reward').textContent);
                const maxConversions = Math.floor(budget / tierValue);
                const totalCost = maxConversions * tierValue;

                document.getElementById('cost-per-conversion').textContent = tierValue;
                document.getElementById('max-conversions').textContent = maxConversions;
                document.getElementById('total-cost').textContent = totalCost;
            }
        }

        async function createCampaign() {
            const title = document.getElementById('campaign-title').value;
            const targetLink = document.getElementById('target-link').value;
            const channelId = document.getElementById('channel-id').value;
            const verificationMode = document.getElementById('verification-mode').value;
            const minStay = parseInt(document.getElementById('min-stay').value);
            const budget = parseInt(document.getElementById('campaign-budget').value);
            const selectedTier = document.querySelector('.tier-option.selected');
            
            if (!selectedTier) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„');
                return;
            }

            const rewardTier = parseInt(selectedTier.querySelector('.tier-reward').textContent);
            const userReward = rewardTier - SYSTEM_FEE;

            // Check advertiser balance
            const advertiserRef = db.ref('advertisers/' + currentAdvertiserId);
            const advertiserSnap = await advertiserRef.once('value');
            const advertiser = advertiserSnap.val();

            if (advertiser.pointsBalance < budget) {
                alert('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ù„Ø©');
                return;
            }

            // Create campaign
            const campaignId = 'camp_' + Date.now();
            const campaignRef = db.ref('campaigns/' + campaignId);
            
            const campaignData = {
                campaignId: campaignId,
                advertiserId: currentAdvertiserId,
                title: title,
                targetLink: targetLink,
                channelId: channelId || null,
                verificationMode: verificationMode,
                rewardTier: rewardTier,
                userReward: userReward,
                systemFee: SYSTEM_FEE,
                minStaySeconds: minStay,
                budget: budget,
                spent: 0,
                conversions: 0,
                status: 'active',
                createdAt: Date.now()
            };

            try {
                // Deduct budget from advertiser
                await advertiserRef.update({
                    pointsBalance: advertiser.pointsBalance - budget,
                    activeCampaigns: (advertiser.activeCampaigns || 0) + 1
                });

                // Create campaign
                await campaignRef.set(campaignData);

                // Record transaction
                await recordTransaction('debit', currentAdvertiserId, 'system', budget, 'campaign_budget');

                alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                document.getElementById('campaign-form').reset();
                loadCampaigns();
                loadAdvertiserData();
            } catch (error) {
                console.error('Error creating campaign:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù…Ù„Ø©');
            }
        }

        async function loadCampaigns() {
            const campaignsRef = db.ref('campaigns').orderByChild('advertiserId').equalTo(currentAdvertiserId);
            const snapshot = await campaignsRef.once('value');
            const container = document.getElementById('campaigns-list');
            
            container.innerHTML = '';

            if (!snapshot.exists()) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</p>';
                return;
            }

            let totalCampaigns = 0;
            snapshot.forEach(campaignSnap => {
                const campaign = campaignSnap.val();
                totalCampaigns++;
                
                const campaignCard = document.createElement('div');
                campaignCard.className = 'card campaign-card';
                campaignCard.innerHTML = `
                    <div class="card-header">
                        <h3>${campaign.title}</h3>
                        <span class="badge ${campaign.status === 'active' ? 'badge-success' : 'badge-warning'}">${campaign.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…ØªÙˆÙ‚Ù'}</span>
                    </div>
                    <p><strong>Ø§Ù„Ø±Ø§Ø¨Ø·:</strong> ${campaign.targetLink}</p>
                    <p><strong>Ø³Ø¹Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„:</strong> ${campaign.rewardTier} Ù†Ù‚Ø·Ø©</p>
                    <p><strong>Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${campaign.userReward} Ù†Ù‚Ø·Ø©</p>
                    <div class="campaign-stats">
                        <div class="campaign-stat">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">${campaign.conversions || 0}</div>
                            <div>Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</div>
                        </div>
                        <div class="campaign-stat">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--success);">${campaign.spent || 0}</div>
                            <div>Ø§Ù„Ù…ØµØ±ÙˆÙ</div>
                        </div>
                        <div class="campaign-stat">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning);">${campaign.budget - (campaign.spent || 0)}</div>
                            <div>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${((campaign.spent || 0) / campaign.budget) * 100}%"></div>
                    </div>
                    <button class="btn btn-warning" onclick="pauseCampaign('${campaign.campaignId}')" ${campaign.status !== 'active' ? 'disabled' : ''}>
                        <i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
                    </button>
                `;
                container.appendChild(campaignCard);
            });

            document.getElementById('total-campaigns').textContent = totalCampaigns;
        }

        async function loadConversions() {
            const conversionsRef = db.ref('conversions').orderByChild('advertiserId').equalTo(currentAdvertiserId);
            const snapshot = await conversionsRef.once('value');
            const container = document.getElementById('conversions-list');
            
            container.innerHTML = '';
            let totalConversions = 0;

            if (!snapshot.exists()) {
                container.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­ÙˆÙŠÙ„Ø§Øª</td></tr>';
                document.getElementById('total-conversions').textContent = '0';
                return;
            }

            snapshot.forEach(conversionSnap => {
                const conversion = conversionSnap.val();
                totalConversions++;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${conversion.campaignTitle || 'N/A'}</td>
                    <td>${conversion.userId || 'Ù…Ø³ØªØ®Ø¯Ù…'}</td>
                    <td>${conversion.userReward} Ù†Ù‚Ø·Ø©</td>
                    <td><span class="badge ${getStatusBadge(conversion.status)}">${getStatusText(conversion.status)}</span></td>
                    <td>${new Date(conversion.timestamp).toLocaleString('ar-EG')}</td>
                    <td>
                        ${conversion.status === 'pending' ? `
                            <button class="btn btn-success" onclick="approveConversion('${conversionSnap.key}')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                            <button class="btn btn-danger" onclick="rejectConversion('${conversionSnap.key}')">Ø±ÙØ¶</button>
                        ` : '-'}
                    </td>
                `;
                container.appendChild(row);
            });

            document.getElementById('total-conversions').textContent = totalConversions;
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'completed': return 'badge-success';
                case 'pending': return 'badge-warning';
                case 'rejected': return 'badge-danger';
                case 'fraud': return 'badge-danger';
                default: return 'badge-info';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'completed': return 'Ù…ÙƒØªÙ…Ù„';
                case 'pending': return 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
                case 'rejected': return 'Ù…Ø±ÙÙˆØ¶';
                case 'fraud': return 'Ø§Ø­ØªÙŠØ§Ù„';
                default: return status;
            }
        }

        async function loadAdvertiserData() {
            const advertiserRef = db.ref('advertisers/' + currentAdvertiserId);
            const snapshot = await advertiserRef.once('value');
            
            if (snapshot.exists()) {
                const advertiser = snapshot.val();
                document.getElementById('advertiser-balance').textContent = advertiser.pointsBalance;
                document.getElementById('advertiser-points').textContent = advertiser.pointsBalance;
            }

            // Calculate system revenue
            const transactionsRef = db.ref('transactions').orderByChild('to').equalTo('system');
            const transactionsSnap = await transactionsRef.once('value');
            let systemRevenue = 0;
            
            transactionsSnap.forEach(transactionSnap => {
                const transaction = transactionSnap.val();
                systemRevenue += transaction.points;
            });

            document.getElementById('system-revenue').textContent = systemRevenue;
            document.getElementById('system-points').textContent = systemRevenue;
        }

        async function loadTransactions() {
            const transactionsRef = db.ref('transactions').orderByChild('from').equalTo(currentAdvertiserId);
            const snapshot = await transactionsRef.once('value');
            const container = document.getElementById('transactions-list');
            
            container.innerHTML = '';

            if (!snapshot.exists()) {
                container.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</td></tr>';
                return;
            }

            snapshot.forEach(transactionSnap => {
                const transaction = transactionSnap.val();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="badge ${transaction.type === 'debit' ? 'badge-danger' : 'badge-success'}">${transaction.type === 'debit' ? 'Ù…Ø¯ÙŠÙ†' : 'Ø¯Ø§Ø¦Ù†'}</span></td>
                    <td>${transaction.points} Ù†Ù‚Ø·Ø©</td>
                    <td>${getTransactionReason(transaction.reason)}</td>
                    <td>${new Date(transaction.timestamp).toLocaleString('ar-EG')}</td>
                `;
                container.appendChild(row);
            });
        }

        function getTransactionReason(reason) {
            const reasons = {
                'campaign_budget': 'Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø­Ù…Ù„Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©',
                'conversion_payout': 'Ø¯ÙØ¹ Ù…Ù‚Ø§Ø¨Ù„ ØªØ­ÙˆÙŠÙ„',
                'points_purchase': 'Ø´Ø±Ø§Ø¡ Ù†Ù‚Ø§Ø·',
                'refund': 'Ø§Ø³ØªØ±Ø¯Ø§Ø¯'
            };
            return reasons[reason] || reason;
        }

        async function recordTransaction(type, from, to, points, reason) {
            const transactionId = 'tx_' + Date.now();
            const transactionRef = db.ref('transactions/' + transactionId);
            
            await transactionRef.set({
                transactionId: transactionId,
                type: type,
                from: from,
                to: to,
                points: points,
                reason: reason,
                timestamp: Date.now()
            });
        }

        async function addPoints() {
            const points = prompt('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§:');
            if (points && !isNaN(points) && parseInt(points) > 0) {
                const advertiserRef = db.ref('advertisers/' + currentAdvertiserId);
                const snapshot = await advertiserRef.once('value');
                const advertiser = snapshot.val();
                
                await advertiserRef.update({
                    pointsBalance: advertiser.pointsBalance + parseInt(points)
                });

                await recordTransaction('credit', 'system', currentAdvertiserId, parseInt(points), 'points_purchase');
                
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!');
                loadAdvertiserData();
                loadTransactions();
            }
        }

        async function approveConversion(conversionId) {
            const conversionRef = db.ref('conversions/' + conversionId);
            const conversionSnap = await conversionRef.once('value');
            const conversion = conversionSnap.val();

            // Update conversion status
            await conversionRef.update({
                status: 'completed',
                approvedAt: Date.now()
            });

            // Record payout transaction
            await recordTransaction('credit', 'system', conversion.userId, conversion.userReward, 'conversion_payout');

            // Update campaign stats
            const campaignRef = db.ref('campaigns/' + conversion.campaignId);
            const campaignSnap = await campaignRef.once('value');
            const campaign = campaignSnap.val();

            await campaignRef.update({
                conversions: (campaign.conversions || 0) + 1,
                spent: (campaign.spent || 0) + conversion.rewardTier
            });

            alert('ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØªÙ… Ø¯ÙØ¹ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©!');
            loadConversions();
            loadCampaigns();
        }

        async function rejectConversion(conversionId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŸ')) {
                const conversionRef = db.ref('conversions/' + conversionId);
                await conversionRef.update({
                    status: 'rejected',
                    rejectedAt: Date.now()
                });

                // Refund to advertiser
                const conversionSnap = await conversionRef.once('value');
                const conversion = conversionSnap.val();
                const advertiserRef = db.ref('advertisers/' + currentAdvertiserId);
                const advertiserSnap = await advertiserRef.once('value');
                const advertiser = advertiserSnap.val();

                await advertiserRef.update({
                    pointsBalance: advertiser.pointsBalance + conversion.rewardTier
                });

                await recordTransaction('credit', 'system', currentAdvertiserId, conversion.rewardTier, 'refund');

                alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨Ù„Øº!');
                loadConversions();
                loadAdvertiserData();
            }
        }

        async function pauseCampaign(campaignId) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙŠÙ‚Ø§Ù Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ù„Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ØŸ')) {
                const campaignRef = db.ref('campaigns/' + campaignId);
                await campaignRef.update({
                    status: 'paused'
                });
                loadCampaigns();
            }
        }

        // Simulate a conversion for demonstration
        window.simulateConversion = async function(campaignId) {
            const campaignRef = db.ref('campaigns/' + campaignId);
            const campaignSnap = await campaignRef.once('value');
            const campaign = campaignSnap.val();

            const conversionId = 'conv_' + Date.now();
            const conversionRef = db.ref('conversions/' + conversionId);

            await conversionRef.set({
                conversionId: conversionId,
                campaignId: campaignId,
                campaignTitle: campaign.title,
                advertiserId: currentAdvertiserId,
                userId: 'user_' + Date.now(),
                rewardTier: campaign.rewardTier,
                userReward: campaign.userReward,
                systemFee: campaign.systemFee,
                status: 'pending',
                timestamp: Date.now(),
                deviceId: 'device_' + Math.random(),
                ip: '192.168.1.' + Math.floor(Math.random() * 255)
            });

            alert('ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­ÙˆÙŠÙ„ Ø¬Ø¯ÙŠØ¯! Ø±Ø§Ø¬Ø¹ Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.');
            loadConversions();
        };
    </script>
</body>
</html>
