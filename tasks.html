<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© - LIMONACH</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <h1 data-translate="tasks.title">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
            <a href="index.html" class="back-button">â†</a>
        </div>

        <!-- Stats -->
        <div class="card stats-row">
            <div>
                <p class="label" data-translate="tasks.available">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</p>
                <p id="availableCount" class="stat-value primary">0</p>
            </div>
            <div class="text-left">
                <p class="label" data-translate="tasks.completed">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</p>
                <p id="completedCount" class="stat-value secondary">0</p>
            </div>
        </div>

        <!-- Watch Ad Section -->
        <div class="section">
            <h2 class="section-title">
                <span>ğŸ“º</span>
                <span data-translate="tasks.watchAd">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Monetag</span>
            </h2>

            <div class="card watch-ad-card">
                <div class="badge-daily" data-translate="tasks.dailyTask">Ù…Ù‡Ù…Ø© ÙŠÙˆÙ…ÙŠØ© â­</div>
                <div class="card-content">
                    <div class="task-header">
                        <span class="task-icon">ğŸ“º</span>
                        <div>
                            <h3 data-translate="tasks.watchAndEarn">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† ÙˆØ±Ø¨Ø­ 10 Ù†Ù‚Ø§Ø·</h3>
                            <p data-translate="tasks.watchDesc">Ø´Ø§Ù‡Ø¯ Ø¥Ø¹Ù„Ø§Ù† Ù‚ØµÙŠØ± ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ 10 Ù†Ù‚Ø§Ø· ÙÙˆØ±Ù‹Ø§</p>
                            <p class="daily-limit">
                                <span data-translate="tasks.dailyLimit">Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>: 
                                <span id="adsWatched">0</span>/30
                            </p>
                        </div>
                    </div>
                    
                    <div class="task-footer">
                        <div class="reward">
                            <span class="reward-amount gradient-text">+10</span>
                            <span class="reward-label" data-translate="home.points">Ù†Ù‚Ø·Ø©</span>
                        </div>
                        <button id="watchAdBtn" onclick="watchAd()" class="btn btn-primary">
                            <span data-translate="tasks.watchNow">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†</span>
                            <span>â–¶ï¸</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Advertisements -->
        <div id="userAdsSection" class="section" style="display: none;">
            <h2 class="section-title">
                <span>âœ¨</span>
                <span data-translate="tasks.userAds">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
            </h2>
            <div id="userAdsContainer"></div>
        </div>

        <!-- Completed Ads -->
        <div id="completedAdsSection" class="section" style="display: none;">
            <h2 class="section-title">
                <span>âœ…</span>
                <span data-translate="tasks.completed">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</span>
            </h2>
            <div id="completedAdsContainer"></div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="script.js"></script>
    <script>
        let adsWatchedToday = 0;
        const MAX_ADS_PER_DAY = 30;

        function initTasks() {
            // Load ads watched today
            const today = new Date().toDateString();
            const stored = localStorage.getItem('limonach_ads');
            if (stored) {
                const data = JSON.parse(stored);
                if (data.date === today) {
                    adsWatchedToday = data.count;
                } else {
                    localStorage.setItem('limonach_ads', JSON.stringify({ date: today, count: 0 }));
                    adsWatchedToday = 0;
                }
            } else {
                localStorage.setItem('limonach_ads', JSON.stringify({ date: today, count: 0 }));
            }
            
            document.getElementById('adsWatched').textContent = adsWatchedToday;
            
            if (adsWatchedToday >= MAX_ADS_PER_DAY) {
                const btn = document.getElementById('watchAdBtn');
                btn.disabled = true;
                btn.innerHTML = '<span data-translate="tasks.completedToday">Ù…ÙƒØªÙ…Ù„ Ø§Ù„ÙŠÙˆÙ…</span>';
                translatePage();
            }

            loadAdvertisements();
        }

        function watchAd() {
            if (adsWatchedToday >= MAX_ADS_PER_DAY) {
                showToast(getTranslation('tasks.dailyLimitReached'), 'error');
                return;
            }

            showToast(getTranslation('tasks.loadingAd'), 'info');
            
            // Simulate ad watching
            setTimeout(() => {
                adsWatchedToday++;
                const today = new Date().toDateString();
                localStorage.setItem('limonach_ads', JSON.stringify({ date: today, count: adsWatchedToday }));
                
                // Add points
                const currentPoints = parseInt(localStorage.getItem('limonach_points') || '0');
                localStorage.setItem('limonach_points', (currentPoints + 10).toString());
                
                // Update completed tasks
                const completedTasks = parseInt(localStorage.getItem('completed_tasks') || '0');
                localStorage.setItem('completed_tasks', (completedTasks + 1).toString());
                
                // Update total earned points
                const totalPoints = parseInt(localStorage.getItem('total_earned_points') || '0');
                localStorage.setItem('total_earned_points', (totalPoints + 10).toString());
                
                document.getElementById('adsWatched').textContent = adsWatchedToday;
                
                if (adsWatchedToday >= MAX_ADS_PER_DAY) {
                    const btn = document.getElementById('watchAdBtn');
                    btn.disabled = true;
                    btn.innerHTML = '<span data-translate="tasks.completedToday">Ù…ÙƒØªÙ…Ù„ Ø§Ù„ÙŠÙˆÙ…</span>';
                    translatePage();
                }
                
                showToast(getTranslation('tasks.adWatched') + ' (' + adsWatchedToday + '/' + MAX_ADS_PER_DAY + ')', 'success');
            }, 2000);
        }

        function loadAdvertisements() {
            const storedAds = localStorage.getItem('limonach_advertisements');
            if (!storedAds) {
                document.getElementById('availableCount').textContent = '0';
                document.getElementById('completedCount').textContent = '0';
                return;
            }

            const ads = JSON.parse(storedAds);
            const activeAds = ads.filter(ad => !ad.completed && !ad.paused);
            const completedAds = ads.filter(ad => ad.completed);

            document.getElementById('availableCount').textContent = activeAds.length;
            document.getElementById('completedCount').textContent = completedAds.length;

            if (activeAds.length > 0) {
                document.getElementById('userAdsSection').style.display = 'block';
                renderAds(activeAds, 'userAdsContainer', false);
            }

            if (completedAds.length > 0) {
                document.getElementById('completedAdsSection').style.display = 'block';
                renderAds(completedAds, 'completedAdsContainer', true);
            }
        }

        function renderAds(ads, containerId, isCompleted) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            ads.forEach(ad => {
                const adCard = document.createElement('div');
                adCard.className = 'card ad-card' + (isCompleted ? ' completed-ad' : '');
                adCard.innerHTML = `
                    <div class="task-header">
                        <span class="task-icon">ğŸ“¢</span>
                        <div>
                            <h3>${ad.title}</h3>
                            <p>${ad.description}</p>
                            <p class="ad-progress">${ad.currentUsers}/${ad.targetUsers} <span data-translate="tasks.users">Ù…Ø³ØªØ®Ø¯Ù…</span></p>
                        </div>
                    </div>
                    ${!isCompleted ? `
                    <div class="task-footer">
                        <div class="reward">
                            <span class="reward-amount gradient-text">+${ad.reward}</span>
                            <span class="reward-label" data-translate="home.points">Ù†Ù‚Ø·Ø©</span>
                        </div>
                        <button onclick="completeAd('${ad.id}')" class="btn btn-primary">
                            <span data-translate="tasks.execute">ØªÙ†ÙÙŠØ°</span>
                            <span>ğŸ”—</span>
                        </button>
                    </div>
                    ` : '<div class="completed-badge">âœ…</div>'}
                `;
                container.appendChild(adCard);
            });

            translatePage();
        }

        function completeAd(adId) {
            const storedAds = localStorage.getItem('limonach_advertisements');
            if (!storedAds) return;

            const ads = JSON.parse(storedAds);
            const ad = ads.find(a => a.id === adId);
            if (!ad) return;

            // Increment clicks
            ad.clicks = (ad.clicks || 0) + 1;
            localStorage.setItem('limonach_advertisements', JSON.stringify(ads));

            // Open link
            window.open(ad.link, '_blank');

            // Complete after delay
            setTimeout(() => {
                const currentPoints = parseInt(localStorage.getItem('limonach_points') || '0');
                localStorage.setItem('limonach_points', (currentPoints + ad.reward).toString());

                const completedTasks = parseInt(localStorage.getItem('completed_tasks') || '0');
                localStorage.setItem('completed_tasks', (completedTasks + 1).toString());

                const totalPoints = parseInt(localStorage.getItem('total_earned_points') || '0');
                localStorage.setItem('total_earned_points', (totalPoints + ad.reward).toString());

                ad.completed = true;
                ad.currentUsers++;
                localStorage.setItem('limonach_advertisements', JSON.stringify(ads));

                showToast(getTranslation('tasks.taskCompleted') + ' +' + ad.reward + ' Ù†Ù‚Ø·Ø© ğŸ‰', 'success');
                loadAdvertisements();
            }, 2000);
        }

        document.addEventListener('DOMContentLoaded', initTasks);
    </script>
</body>
</html>
