<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†Ùƒ - LIMONACH</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <h1 data-translate="advertise.title">Ø£Ø¶Ù Ø¥Ø¹Ù„Ø§Ù†Ùƒ</h1>
            <a href="index.html" class="back-button">â†</a>
        </div>

        <!-- Hero Card -->
        <div class="card hero-card">
            <div class="hero-content">
                <span class="hero-icon">ğŸ“¢</span>
                <h2 data-translate="advertise.hero">Ø±ÙˆÙ‘Ø¬ Ù„Ù‚Ù†Ø§ØªÙƒ Ø£Ùˆ Ù…ÙˆÙ‚Ø¹Ùƒ</h2>
                <p data-translate="advertise.heroDesc">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¢Ù„Ø§Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ†</p>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid-3">
            <div class="card stat-card">
                <p id="activeUsers" class="stat-value primary">0</p>
                <p class="stat-label" data-translate="advertise.activeUsers">Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø´Ø·</p>
            </div>
            <div class="card stat-card">
                <p id="completionRate" class="stat-value secondary">0%</p>
                <p class="stat-label" data-translate="advertise.completionRate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</p>
            </div>
            <div class="card stat-card">
                <p class="stat-value accent">24h</p>
                <p class="stat-label" data-translate="advertise.startTime">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡</p>
            </div>
        </div>

        <!-- Form -->
        <div class="card form-card">
            <h3 data-translate="advertise.details">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h3>
            
            <div class="form-group">
                <label data-translate="advertise.taskTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <input type="text" id="adTitle" data-translate-placeholder="advertise.taskTitlePlaceholder" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ù‚Ù†Ø§Ø© @YourChannel">
            </div>

            <div class="form-group">
                <label data-translate="advertise.description">Ø§Ù„ÙˆØµÙ</label>
                <textarea id="adDescription" rows="3" data-translate-placeholder="advertise.descriptionPlaceholder" placeholder="Ø§Ø´Ø±Ø­ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea>
            </div>

            <div class="form-group">
                <label data-translate="advertise.link">Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ù†Ø§Ø©/Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                <input type="url" id="adLink" data-translate-placeholder="advertise.linkPlaceholder" placeholder="https://t.me/YourChannel">
            </div>

            <div class="form-group">
                <label>
                    <span data-translate="advertise.usersCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</span> 10)
                </label>
                <input type="number" id="adUsers" placeholder="10" min="10">
                <p class="form-hint">
                    <span data-translate="advertise.rewardPerUser">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…</span>: 10 
                    <span data-translate="home.points">Ù†Ù‚Ø·Ø©</span>
                </p>
            </div>
        </div>

        <!-- Pricing -->
        <div class="card pricing-card">
            <div class="pricing-header">
                <div>
                    <p class="label" data-translate="advertise.pricePerUser">Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…</p>
                    <p class="price-value primary">15 <span data-translate="home.points">Ù†Ù‚Ø·Ø©</span></p>
                </div>
                <span class="price-icon">ğŸ“ˆ</span>
            </div>

            <div class="divider"></div>

            <div class="pricing-footer">
                <p class="total-label" data-translate="advertise.totalCost">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</p>
                <p id="totalCost" class="total-value gradient-text">0 <span data-translate="home.points">Ù†Ù‚Ø·Ø©</span></p>
            </div>

            <button onclick="submitAd()" class="btn btn-primary btn-large">
                <span data-translate="advertise.addAndPay">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø¯ÙØ¹</span>
                (<span id="totalCostBtn">0</span> <span data-translate="home.points">Ù†Ù‚Ø·Ø©</span>)
            </button>
        </div>

        <!-- Features -->
        <div class="card features-card">
            <h3 data-translate="advertise.whyAdvertise">Ù„Ù…Ø§Ø°Ø§ ØªØ¹Ù„Ù† Ù…Ø¹Ù†Ø§ØŸ</h3>
            
            <div class="features-list">
                <div class="feature-item">
                    <div class="feature-icon primary">âœ“</div>
                    <p data-translate="advertise.feature1">Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø­Ù‚ÙŠÙ‚ÙŠÙˆÙ† ÙˆÙ†Ø´Ø·ÙˆÙ†</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon secondary">âœ“</div>
                    <p data-translate="advertise.feature2">ØªØ­Ù‚Ù‚ Ø¢Ù„ÙŠ Ù…Ù† Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon accent">âœ“</div>
                    <p data-translate="advertise.feature3">Ù†ØªØ§Ø¦Ø¬ Ø³Ø±ÙŠØ¹Ø© Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©</p>
                </div>
                <div class="feature-item">
                    <div class="feature-icon primary">âœ“</div>
                    <p data-translate="advertise.feature4">Ø¯Ø¹Ù… ÙÙ†ÙŠ Ù…ØªÙˆØ§ØµÙ„</p>
                </div>
            </div>
        </div>

        <!-- My Ads Tracking -->
        <div id="myAdsSection" class="card" style="display: none;">
            <h3 class="section-title">
                <span>ğŸ‘ï¸</span>
                <span>ØªØªØ¨Ø¹ Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</span>
            </h3>
            <div id="myAdsContainer"></div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="script.js"></script>
    <script>
        const REWARD_PER_USER = 10;
        const PRICE_PER_USER = 15;
        const MIN_USERS = 10;

        function initAdvertise() {
            calculateStats();
            loadMyAds();
            
            // Update total cost on input
            document.getElementById('adUsers').addEventListener('input', updateTotalCost);
        }

        function updateTotalCost() {
            const users = parseInt(document.getElementById('adUsers').value) || 0;
            const totalCost = users * PRICE_PER_USER;
            document.getElementById('totalCost').innerHTML = totalCost + ' <span data-translate="home.points">Ù†Ù‚Ø·Ø©</span>';
            document.getElementById('totalCostBtn').textContent = totalCost;
            translatePage();
        }

        function calculateStats() {
            const storedAds = localStorage.getItem('limonach_advertisements');
            if (!storedAds) return;

            const ads = JSON.parse(storedAds);
            const totalCompletedUsers = ads.reduce((sum, ad) => sum + (ad.currentUsers || 0), 0);
            const totalTargetUsers = ads.reduce((sum, ad) => sum + ad.targetUsers, 0);
            
            document.getElementById('activeUsers').textContent = totalCompletedUsers;
            
            if (totalTargetUsers > 0) {
                const rate = Math.round((totalCompletedUsers / totalTargetUsers) * 100);
                document.getElementById('completionRate').textContent = rate + '%';
            }
        }

        function submitAd() {
            const title = document.getElementById('adTitle').value.trim();
            const description = document.getElementById('adDescription').value.trim();
            const link = document.getElementById('adLink').value.trim();
            const users = parseInt(document.getElementById('adUsers').value);

            if (!title || !description || !link || !users) {
                showToast(getTranslation('advertise.fillAllFields'), 'error');
                return;
            }

            if (users < MIN_USERS) {
                showToast(getTranslation('advertise.minUsers') + ' ' + MIN_USERS + ' ' + getTranslation('tasks.users'), 'error');
                return;
            }

            const totalCost = users * PRICE_PER_USER;
            const currentPoints = parseInt(localStorage.getItem('limonach_points') || '0');
            
            if (currentPoints < totalCost) {
                showToast(getTranslation('advertise.insufficientBalance') + ' ' + totalCost + ' ' + getTranslation('home.points'), 'error');
                return;
            }

            // Deduct points
            localStorage.setItem('limonach_points', (currentPoints - totalCost).toString());

            // Save ad
            const newAd = {
                id: Date.now().toString(),
                title: title,
                description: description,
                reward: REWARD_PER_USER,
                link: link,
                targetUsers: users,
                currentUsers: 0,
                clicks: 0,
                paused: false,
                status: 'active',
                completed: false,
                createdAt: new Date().toISOString()
            };

            const storedAds = localStorage.getItem('limonach_advertisements');
            const ads = storedAds ? JSON.parse(storedAds) : [];
            ads.push(newAd);
            localStorage.setItem('limonach_advertisements', JSON.stringify(ads));

            showToast(getTranslation('advertise.adAdded') + ' ' + totalCost + ' ' + getTranslation('home.points') + ' ğŸ‰', 'success');
            
            // Clear form
            document.getElementById('adTitle').value = '';
            document.getElementById('adDescription').value = '';
            document.getElementById('adLink').value = '';
            document.getElementById('adUsers').value = '';
            updateTotalCost();
            
            calculateStats();
            loadMyAds();
        }

        function loadMyAds() {
            const storedAds = localStorage.getItem('limonach_advertisements');
            if (!storedAds) return;

            const ads = JSON.parse(storedAds);
            if (ads.length === 0) return;

            document.getElementById('myAdsSection').style.display = 'block';
            const container = document.getElementById('myAdsContainer');
            container.innerHTML = '';

            ads.forEach(ad => {
                const adCard = document.createElement('div');
                adCard.className = 'my-ad-card';
                adCard.innerHTML = `
                    <div class="my-ad-header">
                        <div>
                            <h4>${ad.title}</h4>
                            <p class="my-ad-desc">${ad.description}</p>
                        </div>
                        ${ad.paused ? '<span class="badge-paused">Ù…ØªÙˆÙ‚Ù</span>' : ''}
                    </div>
                    <div class="my-ad-stats">
                        <div class="my-ad-stat primary">
                            <p class="label">Ø§Ù„Ù†Ù‚Ø±Ø§Øª</p>
                            <p class="value">${ad.clicks || 0}</p>
                        </div>
                        <div class="my-ad-stat secondary">
                            <p class="label">Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
                            <p class="value">${ad.currentUsers}/${ad.targetUsers}</p>
                        </div>
                        <div class="my-ad-stat accent">
                            <p class="label">Ø§Ù„Ø­Ø§Ù„Ø©</p>
                            <p class="value">${ad.completed ? 'Ù…ÙƒØªÙ…Ù„' : ad.paused ? 'Ù…ØªÙˆÙ‚Ù' : 'Ù†Ø´Ø·'}</p>
                        </div>
                    </div>
                    <div class="my-ad-actions">
                        <button onclick="togglePause('${ad.id}')" class="btn btn-outline" ${ad.completed ? 'disabled' : ''}>
                            ${ad.paused ? 'â–¶ï¸ ØªØ´ØºÙŠÙ„' : 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª'}
                        </button>
                    </div>
                `;
                container.appendChild(adCard);
            });
        }

        function togglePause(adId) {
            const storedAds = localStorage.getItem('limonach_advertisements');
            if (!storedAds) return;

            const ads = JSON.parse(storedAds);
            const ad = ads.find(a => a.id === adId);
            if (!ad) return;

            ad.paused = !ad.paused;
            localStorage.setItem('limonach_advertisements', JSON.stringify(ads));

            showToast(ad.paused ? getTranslation('advertise.adPaused') : getTranslation('advertise.adResumed'), 'success');
            loadMyAds();
            calculateStats();
        }

        document.addEventListener('DOMContentLoaded', initAdvertise);
    </script>
</body>
</html>
